  test_android_lib_release:
    docker:
      - image: darakeon/android
    resource_class: large
    steps:
      - checkout
      - attach_workspace:
          at: android
      - restore_cache:
          keys:
            - kotlin-{{ checksum "android/cache_key" }}
      - run:
          name: tests lib release
          path: android
          command: gradle-with-metadata :Lib:testReleaseUnitTest -x androidDependencies -x build -x packageRelease -x packageDebug
      - store_artifacts:
          path: android/Lib/log
          destination: log/lib
      - store_artifacts:
          path: android/gradle/verification-metadata.xml
          destination: verification-metadata.xml
      - store_test_results:
          path: android/Lib/build/test-results

