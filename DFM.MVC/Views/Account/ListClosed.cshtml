@model DFM.MVC.Models.AccountIndexModel

@{
    ViewBag.Title = PlainText.Dictionary["ClosedAccounts"];
    Layout = "~/Views/Shared/Inner/_Layout.cshtml";
}

@if (!Model.AccountList.Any())
{ 
    <div class="ZeroItems">@PlainText.Dictionary["NoClosedAccounts"]</div>
}
else
{ 
        
    <table class="List">

        <tr>
            <th>@PlainText.Dictionary["Name"]</th>
            <th>@PlainText.Dictionary["BeginDate"]</th>
            <th>@PlainText.Dictionary["EndDate"]</th>
            <th>@PlainText.Dictionary["Value"]</th>
            <th colspan="2">@PlainText.Dictionary["GOTO"]</th>
        </tr>

        @foreach (var account in Model.AccountList)
        {
            var endMonth = account.EndDate.Value.Month;
            var endYear = account.EndDate.Value.Year;
            var monthReportId = endYear * 100 + endMonth;
            
            <tr>
                <td>@account.Name </td>
                <td>@account.BeginDate.ToShortDateString() </td>
                <td>@account.EndDate.Value.ToShortDateString() </td>


                @{
                    var movesSum = account.Sum();

                    var negative = movesSum < 0;
                    var value = (negative ? -movesSum : movesSum).ToMoney();

                    var sign = account.Sign();
                }

                <td class="numeric @(negative ? "out" : "in")">@value</td>

                <td>@Url.RouteUrl(
                     String.Format(PlainText.Dictionary["MonthMoves"] + " ({1})", PlainText.GetMonthName(endMonth), endYear),
                        RouteNames.Accounts,
                        new { action = "SeeMonth", controller = "Report", accountid = account.ID, id = monthReportId }, new { })</td>
                
                <td>@Html.RouteLink(
                        String.Format(PlainText.Dictionary["YearMoves"], account.EndDate.Value.Year),
                        RouteNames.Accounts,
                        new { action = "SeeYear", controller = "Report", accountid = account.ID, id = endYear }, new { })</td>
            </tr>

        } 

    </table>
} 
