Feature: Fa. Get month report

Background:
	Given test user login
		And I enable Categories use
		And I have an account
		And I have moves of
			| Date       |
			| 2012-03-27 |
			| 2012-03-28 |
			| 2012-03-29 |
			| 2012-03-30 |
			| 2012-03-31 |
			| 2012-04-01 |
			| 2012-04-02 |
			| 2012-04-03 |
			| 2012-04-04 |
			| 2012-04-05 |
			| 2012-04-06 |

Scenario: Fa01. Get with invalid Account name
	Given I pass an invalid account url
		And I pass this date
			| Month | Year |
			| 4     | 2012 |
	When I try to get the month report
	Then I will receive this core error: AccountNotFound
		And I will receive no month report

Scenario: Fa02. Get with Date Year Zero
	Given I pass a valid account url
		And I pass this date
			| Month | Year |
			| 4     | 0    |
	When I try to get the month report
	Then I will receive this core error: InvalidYear
		And I will receive no month report

Scenario: Fa03. Get with Date Month less than 1
	Given I pass a valid account url
		And I pass this date
			| Month | Year |
			| 0     | 2012 |
	When I try to get the month report
	Then I will receive this core error: InvalidMonth
		And I will receive no month report

Scenario: Fa04. Get with Date Month more than 12
	Given I pass a valid account url
		And I pass this date
			| Month | Year |
			| 13    | 2012 |
	When I try to get the month report
	Then I will receive this core error: InvalidMonth
		And I will receive no month report

Scenario: Fa05. Get with next year date
	Given I have moves of
			| Date       |
			| +0         |
		And I pass a valid account url
		And I pass this date
			| Month | Year |
			| +0    | +1   |
	When I try to get the month report
	Then I will receive no core error
		And I will receive the month report
		And there will be no moves

Scenario: Fa06. Get with info all right
	Given I pass a valid account url
		And I pass this date
			| Month | Year |
			| 4     | 2012 |
	When I try to get the month report
	Then I will receive no core error
		And I will receive the month report
		And its sum value will be equal to its moves sum value

Scenario: Fa07. Get move generated by schedule - without Installment
	Given I have this schedule to create
			| Description   | Date       | Nature | Value | Times | Boundless | Frequency | ShowInstallment |
			| Schedule Ea07 | 2020-01-04 | Out    | 10    | 1     | False     | Monthly   | False           |
		And it has no Details
		And it has a Category
		And it has an Account Out
		And it has no Account In
		And I save the schedule
		And robot run the scheduler
		And I pass Account Out url
		And I pass this date
			| Month | Year |
			| 1     | 2020 |
	When I try to get the month report
	Then I will receive no core error
		And I will receive the month report
		And there will have a move with description Schedule Ea07

Scenario: Fa08. Get move generated by schedule - bounded with Installment
	Given I have this schedule to create
			| Description   | Date       | Nature | Value | Times | Boundless | Frequency | ShowInstallment |
			| Schedule Ea08 | 2020-01-04 | Out    | 10    | 2     | False     | Monthly   | True            |
		And it has no Details
		And it has a Category
		And it has an Account Out
		And it has no Account In
		And I save the schedule
		And robot run the scheduler
		And I pass Account Out url
		And I pass this date
			| Month | Year |
			| 1     | 2020 |
	When I try to get the month report
	Then I will receive no core error
		And I will receive the month report
		And there will have a move with description Schedule Ea08 [1/2]

Scenario: Fa09. Get report with the move generated by schedule - boundless with Installment
	Given I have this schedule to create
			| Description   | Date       | Nature | Value | Times | Boundless | Frequency | ShowInstallment |
			| Schedule Ea09 | 2020-01-04 | Out    | 10    |       | True      | Monthly   | True            |
		And it has no Details
		And it has a Category
		And it has an Account Out
		And it has no Account In
		And I save the schedule
		And robot run the scheduler
		And I pass Account Out url
		And I pass this date
			| Month | Year |
			| 1     | 2020 |
	When I try to get the month report
	Then I will receive no core error
		And I will receive the month report
		And there will have a move with description Schedule Ea09 [1]

Scenario: Fa10. Get report with scheduled moves and foreseen balance at the month
	Given I disable Categories use
		And I have schedules of
			| Description     | Date       | Nature | Value | Times | Boundless | Frequency | ShowInstallment |
			| Schedule Ea10 1 | 2220-10-08 | Out    | 10    | 3     | False     | Monthly   | True            |
			| Schedule Ea10 2 | 2220-09-08 | In     | 52    | 3     | False     | Monthly   | True            |
			| Schedule Ea10 3 | 2220-10-08 | In     | 7     | 20    | False     | Daily     | True            |
			| Schedule Ea10 4 | 2215-10-08 | Out    | 13    | 20    | False     | Yearly    | True            |
			| Schedule Ea10 5 | 2220-07-08 | Out    | 32    |       | True      | Monthly   | True            |
			| Schedule Ea10 6 | 2220-10-08 | Out    | 71    | 20    | False     | Monthly   | False           |
			| Schedule Ea10 7 | 2220-10-08 | Out    | 96    |       | True      | Monthly   | False           |
	Given I pass a valid account url
		And I pass this date
			| Month | Year |
			| 10    | 2220 |
	When I try to get the month report
	Then I will receive no core error
		And I will receive the month report
		And there will be these futures moves
			| Description             | Date       | Nature | Value |
			| Schedule Ea10 1 [1/3]   | 2220-10-08 | Out    | 10    |
			| Schedule Ea10 2 [2/3]   | 2220-10-08 | In     | 52    |
			| Schedule Ea10 3 [1/20]  | 2220-10-08 | In     | 7     |
			| Schedule Ea10 4 [6/20]  | 2220-10-08 | Out    | 13    |
			| Schedule Ea10 5 [4]     | 2220-10-08 | Out    | 32    |
			| Schedule Ea10 6         | 2220-10-08 | Out    | 71    |
			| Schedule Ea10 7         | 2220-10-08 | Out    | 96    |
			| Schedule Ea10 3 [2/20]  | 2220-10-09 | In     | 7     |
			| Schedule Ea10 3 [3/20]  | 2220-10-10 | In     | 7     |
			| Schedule Ea10 3 [4/20]  | 2220-10-11 | In     | 7     |
			| Schedule Ea10 3 [5/20]  | 2220-10-12 | In     | 7     |
			| Schedule Ea10 3 [6/20]  | 2220-10-13 | In     | 7     |
			| Schedule Ea10 3 [7/20]  | 2220-10-14 | In     | 7     |
			| Schedule Ea10 3 [8/20]  | 2220-10-15 | In     | 7     |
			| Schedule Ea10 3 [9/20]  | 2220-10-16 | In     | 7     |
			| Schedule Ea10 3 [10/20] | 2220-10-17 | In     | 7     |
			| Schedule Ea10 3 [11/20] | 2220-10-18 | In     | 7     |
			| Schedule Ea10 3 [12/20] | 2220-10-19 | In     | 7     |
			| Schedule Ea10 3 [13/20] | 2220-10-20 | In     | 7     |
			| Schedule Ea10 3 [14/20] | 2220-10-21 | In     | 7     |
			| Schedule Ea10 3 [15/20] | 2220-10-22 | In     | 7     |
			| Schedule Ea10 3 [16/20] | 2220-10-23 | In     | 7     |
			| Schedule Ea10 3 [17/20] | 2220-10-24 | In     | 7     |
			| Schedule Ea10 3 [18/20] | 2220-10-25 | In     | 7     |
			| Schedule Ea10 3 [19/20] | 2220-10-26 | In     | 7     |
			| Schedule Ea10 3 [20/20] | 2220-10-27 | In     | 7     |
		And the foreseen future value part will be -139

Scenario: Fa11. Not get report if user is marked for deletion
	Given I pass a valid account url
		And I pass this date
			| Month | Year |
			| 5     | 2021 |
		But the user is marked for deletion
	When I try to get the month report
	Then I will receive this core error: UserDeleted

Scenario: Fa12. Not get report if user requested wipe
	Given I pass a valid account url
		And I pass this date
			| Month | Year |
			| 6     | 2021 |
		But the user asked data wipe
	When I try to get the month report
	Then I will receive this core error: UserAskedWipe

Scenario: Fa13. Not get report if not signed last contract
	Given I pass a valid account url
		And I pass this date
			| Month | Year |
			| 4     | 2023 |
		But there is a new contract
	When I try to get the month report
	Then I will receive this core error: NotSignedLastContract

Scenario: Fa14. Get report with moves in right order
	Given I have moves of
			| Date       | Description |
			| 2023-12-01 | Move Fa14 0 |
			| 2023-12-01 | Move Fa14 1 |
			| 2023-12-01 | Move Fa14 2 |
			| 2023-12-01 | Move Fa14 3 |
			| 2023-12-01 | Move Fa14 4 |
			| 2023-12-01 | Move Fa14 5 |
			| 2023-12-01 | Move Fa14 6 |
			| 2023-12-01 | Move Fa14 7 |
			| 2023-12-01 | Move Fa14 8 |
			| 2023-12-01 | Move Fa14 9 |
		And I pass a valid account url
		And I pass this date
			| Month | Year |
			| 12    | 2023 |
	When I try to get the month report
	Then I will receive no core error
		And I will receive the month report
		And there will be these moves
			| Date       | Description |
			| 2023-12-01 | Move Fa14 0 |
			| 2023-12-01 | Move Fa14 1 |
			| 2023-12-01 | Move Fa14 2 |
			| 2023-12-01 | Move Fa14 3 |
			| 2023-12-01 | Move Fa14 4 |
			| 2023-12-01 | Move Fa14 5 |
			| 2023-12-01 | Move Fa14 6 |
			| 2023-12-01 | Move Fa14 7 |
			| 2023-12-01 | Move Fa14 8 |
			| 2023-12-01 | Move Fa14 9 |
