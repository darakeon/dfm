@model SettingsTFAModel
@{
	ViewBag.Title = Context.Translate("TFASettings");
	Layout = "~/Views/Shared/Layouts/_Form.cshtml";

	ViewBag.FormSizeSm = 8;
	ViewBag.FormSizeLg = 6;

	var hl = new WizardHL()
		.AddBox("Why", 2)
		.AddBox("Settings", 3)
		.AddBox("SettingsTheme", 3)
		;

	ViewBag.SettingsMenuClass = hl["Settings"];
	ViewBag.SettingsThemeMenuClass = hl["SettingsTheme"];
}

@section Styles {
	<link rel="stylesheet" type="text/css" href="~/Assets/styles/qrcode.css?v=@Cfg.Version" />
}

@section Scripts {
	<script type="text/javascript" src="~/Assets/libs/jquery/jquery.qrcode.min.js?v=@Cfg.Version"></script>
	<script type="text/javascript" src="~/Assets/scripts/qrcode.js?v=@Cfg.Version"></script>
}

@if (!Model.IsActive)
{
	<div class="text-center">
		<span id="qrcode" data-url="@Model.UrlPath">
		</span>

		@Html.HiddenFor(m => m.TFA.Secret)

		<br/>
		<small class="@hl["Why"]">
			<a href="#" role='button' data-toggle='modal' data-target='#tfa-modal'>
				@Context.Translate("TFAWhy")
			</a>
		</small>
	</div>
}

<div class="form-group">
	@Html.LabelFor(m => m.TFA.Code, Context.Translate("Code"), new { @class = "control-label" })
	@Html.TextBoxFor(m => m.TFA.Code, new { @class = "form-control" })
</div>

<div class="form-group">
	@Html.LabelFor(m => m.TFA.Password, Context.Translate("CurrentPassword"), new { @class = "control-label" })
	@Html.PasswordFor(m => m.TFA.Password, new { @class = "form-control" })
</div>

@if (Model.IsActive)
{
	var action = Model.TFAPassword
		? "TFAPasswordDisable"
		: "TFAPasswordEnable";

	@Html.ActionLink(
		Context.Translate(action),
		action, "Settings", null,
		new { @class = "text-warning pull-left" }
	)
}

@await Html.PartialAsync("Modals/TFA")

@section Footer {
	@if (Model.IsActive)
	{
		@Html.ActionLink(
			Context.Translate("LostTFA"),
			"AskRemoveTFA", null, null,
			new { @class = "btn btn-sm btn-info pull-left" }
		)
	}

	<button type="submit"
			class="btn btn-sm btn-@(Model.IsActive ? "warning" : "success") tab-submit">
		@Context.Translate(Model.IsActive ? "TFARemove" : "Save")
	</button>
}
